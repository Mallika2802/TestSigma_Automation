name: Testsigma - Parallel Sanity Suites

on:
  workflow_dispatch: {}
  schedule:
    - cron: "0 9 * * *"     # 02:30 PM IST (09:00 UTC)

jobs:
  testsigma:
    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      matrix:
        suite:
          - name: CUCS_SANITY
            testplan_secret: TPS_WINDOWS_ALL_LATEST_BROWSERS
          - name: TPS_SANITY
            testplan_secret: CUCS_WINDOWS_ALL_LATEST_BROWSERS

    env:
      TESTSIGMA_API_URL: "https://app.testsigma.com/api/v1"

    steps:
      - name: Install jq
        run: |
          sudo apt-get update -y
          sudo apt-get install -y jq

      - name: Trigger Testsigma Execution (${{ matrix.suite.name }})
        id: trigger
        shell: bash
        env:
          TESTSIGMA_API_KEY: ${{ secrets.TESTSIGMA_API_KEY }}
          TESTSIGMA_TESTPLAN_ID: ${{ secrets[matrix.suite.testplan_secret] }}
          TESTSIGMA_ENVIRONMENT_ID: ${{ secrets.TESTSIGMA_ENVIRONMENT_ID }}
        run: |
          set -euo pipefail

          echo "=== Triggering Testsigma: ${{ matrix.suite.name }} ==="
          echo "TestPlanId=$TESTSIGMA_TESTPLAN_ID  EnvironmentId=$TESTSIGMA_ENVIRONMENT_ID"

